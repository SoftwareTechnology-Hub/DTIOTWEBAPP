{% extends "global/base.html" %}
{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile â€“ IoT Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0b0f1a;
    --surface: #111827;
    --card: #161d2e;
    --border: #1e2d45;
    --accent: #00d4ff;
    --accent2: #7c3aed;
    --accent3: #10b981;
    --text: #e2e8f0;
    --muted: #64748b;
    --danger: #ef4444;
    --warning: #f59e0b;
    --c-color: #5b9bd5;
    --cpp-color: #f97316;
    --py-color: #3b82f6;
    --curl-color: #10b981;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    background-image:
      radial-gradient(ellipse at 20% 0%, rgba(0,212,255,0.06) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 0%, rgba(124,58,237,0.06) 0%, transparent 50%);
  }

  .page-wrap {
    max-width: 900px;
    margin: 0 auto;
    padding: 2.5rem 1.5rem 4rem;
  }

  /* â”€â”€â”€ Page Header â”€â”€â”€ */
  .page-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border);
  }
  .avatar {
    width: 52px; height: 52px;
    border-radius: 14px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    display: flex; align-items: center; justify-content: center;
    font-size: 1.4rem; font-weight: 800;
    flex-shrink: 0;
  }
  .page-header h1 {
    font-size: 1.6rem; font-weight: 800;
    letter-spacing: -0.02em;
    color: #fff;
  }
  .page-header p { color: var(--muted); font-size: .85rem; margin-top: 2px; }

  /* â”€â”€â”€ Alert Messages â”€â”€â”€ */
  .alert {
    background: rgba(16,185,129,.1);
    border: 1px solid rgba(16,185,129,.3);
    border-left: 3px solid var(--accent3);
    border-radius: 8px;
    padding: .75rem 1rem;
    margin-bottom: 1.5rem;
    font-size: .9rem;
    color: var(--accent3);
  }

  /* â”€â”€â”€ Section Title â”€â”€â”€ */
  .section-title {
    font-size: .7rem;
    font-weight: 700;
    letter-spacing: .12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: .85rem;
  }

  /* â”€â”€â”€ Card â”€â”€â”€ */
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  /* â”€â”€â”€ Info Table â”€â”€â”€ */
  .info-table { width: 100%; border-collapse: collapse; }
  .info-table tr { border-bottom: 1px solid var(--border); }
  .info-table tr:last-child { border-bottom: none; }
  .info-table td { padding: .75rem 0; font-size: .9rem; }
  .info-table td:first-child { color: var(--muted); width: 110px; }
  .info-table td:last-child { color: var(--text); font-weight: 600; }

  /* â”€â”€â”€ API Key Box â”€â”€â”€ */
  .api-key-wrap {
    display: flex;
    align-items: center;
    gap: .75rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: .85rem 1rem;
    margin: .85rem 0;
  }
  .api-key-dot {
    width: 8px; height: 8px; border-radius: 50%;
    background: var(--accent3);
    box-shadow: 0 0 8px var(--accent3);
    flex-shrink: 0;
  }
  .api-key-value {
    font-family: 'JetBrains Mono', monospace;
    font-size: .8rem;
    color: var(--accent);
    flex: 1;
    word-break: break-all;
    letter-spacing: .03em;
  }
  .btn-copy {
    background: rgba(0,212,255,.1);
    border: 1px solid rgba(0,212,255,.25);
    color: var(--accent);
    border-radius: 7px;
    padding: .4rem .85rem;
    font-size: .8rem;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    cursor: pointer;
    transition: all .2s;
    flex-shrink: 0;
  }
  .btn-copy:hover { background: rgba(0,212,255,.2); }
  .btn-copy.copied { background: rgba(16,185,129,.15); border-color: rgba(16,185,129,.4); color: var(--accent3); }

  .btn-regen {
    background: rgba(239,68,68,.08);
    border: 1px solid rgba(239,68,68,.25);
    color: var(--danger);
    border-radius: 8px;
    padding: .5rem 1.1rem;
    font-size: .82rem;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    cursor: pointer;
    transition: all .2s;
    margin-top: .25rem;
  }
  .btn-regen:hover { background: rgba(239,68,68,.15); }

  /* â”€â”€â”€ Steps â”€â”€â”€ */
  .steps { display: flex; flex-direction: column; gap: .85rem; margin-top: .5rem; }
  .step {
    display: flex; gap: 1rem; align-items: flex-start;
  }
  .step-num {
    width: 28px; height: 28px; border-radius: 8px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    display: flex; align-items: center; justify-content: center;
    font-size: .75rem; font-weight: 800;
    flex-shrink: 0;
    color: #fff;
  }
  .step-body h4 { font-size: .9rem; font-weight: 700; color: #fff; margin-bottom: 2px; }
  .step-body p { font-size: .82rem; color: var(--muted); line-height: 1.5; }
  .step-body code {
    font-family: 'JetBrains Mono', monospace;
    font-size: .78rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: .15rem .4rem;
    color: var(--accent);
  }

  /* â”€â”€â”€ Code Tabs â”€â”€â”€ */
  .code-section { margin-top: 1rem; }
  .tab-bar {
    display: flex;
    gap: .4rem;
    margin-bottom: 0;
    flex-wrap: wrap;
  }
  .tab-btn {
    display: flex; align-items: center; gap: .4rem;
    padding: .45rem .9rem;
    border-radius: 8px 8px 0 0;
    border: 1px solid var(--border);
    border-bottom: none;
    background: var(--surface);
    color: var(--muted);
    font-family: 'Syne', sans-serif;
    font-size: .8rem;
    font-weight: 700;
    cursor: pointer;
    transition: all .2s;
    position: relative;
    bottom: -1px;
  }
  .tab-btn .lang-dot {
    width: 8px; height: 8px; border-radius: 50%;
  }
  .tab-btn.active-c     { background: var(--card); color: var(--c-color);    border-color: var(--c-color);   border-bottom-color: var(--card); }
  .tab-btn.active-cpp   { background: var(--card); color: var(--cpp-color);  border-color: var(--cpp-color); border-bottom-color: var(--card); }
  .tab-btn.active-py    { background: var(--card); color: var(--py-color);   border-color: var(--py-color);  border-bottom-color: var(--card); }
  .tab-btn.active-curl  { background: var(--card); color: var(--curl-color); border-color: var(--curl-color);border-bottom-color: var(--card); }

  .code-panel {
    display: none;
    background: var(--card);
    border-radius: 0 8px 8px 8px;
    border: 1px solid var(--border);
    overflow: hidden;
  }
  .code-panel.show { display: block; }
  .code-panel.border-c    { border-color: var(--c-color); }
  .code-panel.border-cpp  { border-color: var(--cpp-color); }
  .code-panel.border-py   { border-color: var(--py-color); }
  .code-panel.border-curl { border-color: var(--curl-color); }

  .code-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: .6rem 1rem;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
  }
  .code-header span { font-size: .75rem; color: var(--muted); font-family: 'JetBrains Mono', monospace; }
  .btn-copy-code {
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--muted);
    font-size: .72rem;
    padding: .25rem .6rem;
    cursor: pointer;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    transition: all .2s;
  }
  .btn-copy-code:hover { color: var(--text); border-color: var(--text); }

  pre {
    margin: 0;
    padding: 1.2rem 1.2rem 1.4rem;
    overflow-x: auto;
    font-family: 'JetBrains Mono', monospace;
    font-size: .78rem;
    line-height: 1.7;
    color: #cdd6f4;
  }

  /* syntax colors */
  .kw  { color: #cba6f7; } /* keyword / type */
  .fn  { color: #89b4fa; } /* function */
  .str { color: #a6e3a1; } /* string */
  .num { color: #fab387; } /* number */
  .cm  { color: #585b70; font-style: italic; } /* comment */
  .var { color: #cdd6f4; }
  .inc { color: #f38ba8; } /* include/import */
  .hd  { color: #f9e2af; } /* header/key */

  /* â”€â”€â”€ Troubleshooting â”€â”€â”€ */
  .faq { display: flex; flex-direction: column; gap: .75rem; }
  .faq-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    cursor: pointer;
    transition: border-color .2s;
  }
  .faq-item:hover { border-color: rgba(0,212,255,.3); }
  .faq-q {
    display: flex; align-items: center; justify-content: space-between;
    padding: .85rem 1rem;
    font-size: .88rem;
    font-weight: 700;
  }
  .faq-q .icon {
    width: 22px; height: 22px;
    border-radius: 6px;
    display: flex; align-items: center; justify-content: center;
    font-size: .85rem;
    flex-shrink: 0;
  }
  .faq-q .chevron { color: var(--muted); transition: transform .25s; font-size: .75rem; }
  .faq-item.open .chevron { transform: rotate(180deg); }
  .faq-a {
    display: none;
    padding: 0 1rem .9rem;
    font-size: .83rem;
    color: var(--muted);
    line-height: 1.6;
    border-top: 1px solid var(--border);
    padding-top: .75rem;
  }
  .faq-item.open .faq-a { display: block; }

  /* â”€â”€â”€ Support Buttons â”€â”€â”€ */
  .support-btns { display: flex; gap: .75rem; flex-wrap: wrap; margin-top: 1rem; }
  .btn-support {
    display: inline-flex; align-items: center; gap: .4rem;
    padding: .6rem 1.2rem;
    border-radius: 8px;
    font-size: .85rem;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    cursor: pointer;
    text-decoration: none;
    transition: all .2s;
  }
  .btn-email {
    background: rgba(0,212,255,.1);
    border: 1px solid rgba(0,212,255,.3);
    color: var(--accent);
  }
  .btn-email:hover { background: rgba(0,212,255,.2); }
  .btn-docs {
    background: rgba(124,58,237,.1);
    border: 1px solid rgba(124,58,237,.3);
    color: #a78bfa;
  }
  .btn-docs:hover { background: rgba(124,58,237,.2); }

  /* â”€â”€â”€ Grid layout â”€â”€â”€ */
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
  @media(max-width: 640px) { .two-col { grid-template-columns: 1fr; } }
</style>
</head>
<body>
<div class="page-wrap">

  <!-- Page Header -->
  <div class="page-header">
    <div class="avatar">{{ request.user.first_name|slice:":1"|upper }}</div>
    <div>
      <h1>My Profile</h1>
      <p>Manage your account and API credentials</p>
    </div>
  </div>

  <!-- Flash messages -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert">âœ“ {{ message }}</div>
    {% endfor %}
  {% endif %}

  <!-- â•â• Personal Information â•â• -->
  <p class="section-title">Personal Information</p>
  <div class="card">
    <table class="info-table">
      <tr>
        <td>Name</td>
        <td>{{ request.user.first_name }} {{ request.user.last_name }}</td>
      </tr>
      <tr>
        <td>Email</td>
        <td>{{ request.user.email }}</td>
      </tr>
      <tr>
        <td>Phone</td>
        <td>{{ request.user.phone }}</td>
      </tr>
    </table>
  </div>

  <!-- â•â• API Key â•â• -->
  <p class="section-title">Your API Key</p>
  <div class="card">
    <p style="font-size:.82rem; color:var(--muted); margin-bottom:.75rem;">
      Keep this key secret. Use it to authenticate your IoT device or script with the API.
    </p>
    <div class="api-key-wrap">
      <div class="api-key-dot"></div>
      <span class="api-key-value" id="apiKeyVal">{{ request.user.api_key }}</span>
      <button class="btn-copy" onclick="copyKey(this)">Copy</button>
    </div>
    <form method="POST" action="{% url 'regenerate_api_key' %}" style="margin-top:.5rem;">
      {% csrf_token %}
      <button type="submit" class="btn-regen">âŸ³ Regenerate Key</button>
    </form>
  </div>

  <!-- â•â• How to Use â•â• -->
  <p class="section-title">How to Use Your API Key</p>
  <div class="card">
    <div class="steps">
      <div class="step">
        <div class="step-num">1</div>
        <div class="step-body">
          <h4>Copy Your API Key</h4>
          <p>Click the <strong>Copy</strong> button above to copy your unique API key to clipboard. Keep it safe â€” treat it like a password.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-num">2</div>
        <div class="step-body">
          <h4>Set Your Variables</h4>
          <p>In your code, set your <code>API_KEY</code>, the <code>API_URL</code> endpoint, and a <code>FEED_NAME</code> that identifies your data stream.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-num">3</div>
        <div class="step-body">
          <h4>Send Data</h4>
          <p>POST a JSON payload with <code>api_key</code>, <code>feed_name</code>, and <code>value</code> to the endpoint. Pick your language below and follow the example.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â• Code Examples â•â• -->
  <p class="section-title">Send Data â€” Code Examples</p>
  <div class="card">
    <p style="font-size:.82rem; color:var(--muted); margin-bottom:1rem;">
      Choose your language or tool. Replace <code style="font-family:'JetBrains Mono',monospace; color:var(--accent); font-size:.78rem;">YOUR_API_KEY</code> with the key above.
    </p>

    <div class="code-section">
      <div class="tab-bar">
        <button class="tab-btn active-py" onclick="switchTab('py')" id="tab-py">
          <span class="lang-dot" style="background:#3b82f6"></span> Python
        </button>
        <button class="tab-btn" onclick="switchTab('c')" id="tab-c">
          <span class="lang-dot" style="background:#5b9bd5"></span> C
        </button>
        <button class="tab-btn" onclick="switchTab('cpp')" id="tab-cpp">
          <span class="lang-dot" style="background:#f97316"></span> C++
        </button>
        <button class="tab-btn" onclick="switchTab('curl')" id="tab-curl">
          <span class="lang-dot" style="background:#10b981"></span> cURL
        </button>
      </div>

      <!-- Python -->
      <div class="code-panel border-py show" id="panel-py">
        <div class="code-header">
          <span>send_data.py</span>
          <button class="btn-copy-code" onclick="copyCode('code-py', this)">Copy</button>
        </div>
        <pre id="code-py"><span class="inc">import</span> requests
<span class="inc">import</span> random
<span class="inc">import</span> time

<span class="cm"># â”€â”€ Configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="var">API_URL</span>   = <span class="str">"https://dtaiotweb.pythonanywhere.com/api/feed_data"</span>
<span class="var">API_KEY</span>   = <span class="str">"YOUR_API_KEY"</span>   <span class="cm"># â† paste your key here</span>
<span class="var">FEED_NAME</span> = <span class="str">"Hi Test"</span>        <span class="cm"># â† name of your data feed</span>

<span class="cm"># â”€â”€ Main Loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="kw">while</span> <span class="kw">True</span>:
    value = <span class="fn">round</span>(random.<span class="fn">uniform</span>(<span class="num">20.0</span>, <span class="num">40.0</span>), <span class="num">2</span>)  <span class="cm"># simulate sensor</span>

    payload = {
        <span class="str">"api_key"</span>:   <span class="var">API_KEY</span>,
        <span class="str">"feed_name"</span>: <span class="var">FEED_NAME</span>,
        <span class="str">"value"</span>:     value
    }

    <span class="kw">try</span>:
        response = requests.<span class="fn">post</span>(<span class="var">API_URL</span>, json=payload, timeout=<span class="num">5</span>)
        <span class="fn">print</span>(<span class="str">f"Sent: {value} | Status: {response.status_code}"</span>)
        <span class="fn">print</span>(<span class="str">"Response:"</span>, response.<span class="fn">json</span>())
    <span class="kw">except</span> Exception <span class="kw">as</span> e:
        <span class="fn">print</span>(<span class="str">"Error:"</span>, e)

    time.<span class="fn">sleep</span>(<span class="num">3</span>)  <span class="cm"># send every 3 seconds</span></pre>
      </div>

      <!-- C -->
      <div class="code-panel border-c" id="panel-c">
        <div class="code-header">
          <span>send_data.c &nbsp;â€”&nbsp; requires libcurl &amp; cjson</span>
          <button class="btn-copy-code" onclick="copyCode('code-c', this)">Copy</button>
        </div>
        <pre id="code-c"><span class="inc">#include</span> &lt;stdio.h&gt;
<span class="inc">#include</span> &lt;stdlib.h&gt;
<span class="inc">#include</span> &lt;string.h&gt;
<span class="inc">#include</span> &lt;unistd.h&gt;
<span class="inc">#include</span> &lt;curl/curl.h&gt;

<span class="cm">/* â”€â”€ Configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */</span>
<span class="kw">#define</span> <span class="var">API_URL</span>   <span class="str">"https://dtaiotweb.pythonanywhere.com/api/feed_data"</span>
<span class="kw">#define</span> <span class="var">API_KEY</span>   <span class="str">"YOUR_API_KEY"</span>
<span class="kw">#define</span> <span class="var">FEED_NAME</span> <span class="str">"Hi Test"</span>
<span class="kw">#define</span> <span class="var">INTERVAL</span>  <span class="num">3</span>    <span class="cm">/* seconds between sends */</span>

<span class="cm">/* â”€â”€ Helper: simulate a sensor reading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */</span>
<span class="kw">float</span> <span class="fn">read_sensor</span>() {
    <span class="kw">return</span> <span class="num">20.0f</span> + (<span class="fn">rand</span>() % <span class="num">2000</span>) / <span class="num">100.0f</span>;
}

<span class="kw">int</span> <span class="fn">main</span>() {
    <span class="fn">curl_global_init</span>(CURL_GLOBAL_ALL);
    CURL *curl;
    CURLcode res;

    <span class="kw">while</span> (<span class="num">1</span>) {
        <span class="kw">float</span> value = <span class="fn">read_sensor</span>();

        <span class="cm">/* Build JSON payload manually */</span>
        <span class="kw">char</span> json_body[<span class="num">256</span>];
        <span class="fn">snprintf</span>(json_body, <span class="kw">sizeof</span>(json_body),
            <span class="str">"{\"api_key\":\"%s\",\"feed_name\":\"%s\",\"value\":%.2f}"</span>,
            <span class="var">API_KEY</span>, <span class="var">FEED_NAME</span>, value);

        curl = <span class="fn">curl_easy_init</span>();
        <span class="kw">if</span> (curl) {
            <span class="kw">struct</span> curl_slist *headers = NULL;
            headers = <span class="fn">curl_slist_append</span>(headers,
                          <span class="str">"Content-Type: application/json"</span>);

            <span class="fn">curl_easy_setopt</span>(curl, CURLOPT_URL, <span class="var">API_URL</span>);
            <span class="fn">curl_easy_setopt</span>(curl, CURLOPT_HTTPHEADER, headers);
            <span class="fn">curl_easy_setopt</span>(curl, CURLOPT_POSTFIELDS, json_body);

            res = <span class="fn">curl_easy_perform</span>(curl);
            <span class="kw">if</span> (res != CURLE_OK)
                <span class="fn">fprintf</span>(stderr, <span class="str">"Error: %s\n"</span>,
                        <span class="fn">curl_easy_strerror</span>(res));
            <span class="kw">else</span>
                <span class="fn">printf</span>(<span class="str">"Sent: %.2f\n"</span>, value);

            <span class="fn">curl_slist_free_all</span>(headers);
            <span class="fn">curl_easy_cleanup</span>(curl);
        }
        <span class="fn">sleep</span>(<span class="var">INTERVAL</span>);
    }
    <span class="fn">curl_global_cleanup</span>();
    <span class="kw">return</span> <span class="num">0</span>;
}

<span class="cm">/* Compile: gcc send_data.c -o send_data -lcurl */</span></pre>
      </div>

      <!-- C++ -->
      <div class="code-panel border-cpp" id="panel-cpp">
        <div class="code-header">
          <span>send_data.cpp &nbsp;â€”&nbsp; requires libcurl (C++17)</span>
          <button class="btn-copy-code" onclick="copyCode('code-cpp', this)">Copy</button>
        </div>
        <pre id="code-cpp"><span class="inc">#include</span> &lt;iostream&gt;
<span class="inc">#include</span> &lt;string&gt;
<span class="inc">#include</span> &lt;thread&gt;
<span class="inc">#include</span> &lt;chrono&gt;
<span class="inc">#include</span> &lt;cstdlib&gt;
<span class="inc">#include</span> &lt;curl/curl.h&gt;

<span class="cm">// â”€â”€ Configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="kw">const</span> std::<span class="kw">string</span> <span class="var">API_URL</span>   = <span class="str">"https://dtaiotweb.pythonanywhere.com/api/feed_data"</span>;
<span class="kw">const</span> std::<span class="kw">string</span> <span class="var">API_KEY</span>   = <span class="str">"YOUR_API_KEY"</span>;   <span class="cm">// â† paste key</span>
<span class="kw">const</span> std::<span class="kw">string</span> <span class="var">FEED_NAME</span> = <span class="str">"Hi Test"</span>;

<span class="cm">// â”€â”€ Simulate sensor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="kw">float</span> <span class="fn">readSensor</span>() {
    <span class="kw">return</span> <span class="num">20.0f</span> + (<span class="fn">rand</span>() % <span class="num">2000</span>) / <span class="num">100.0f</span>;
}

<span class="cm">// â”€â”€ Send one reading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="kw">void</span> <span class="fn">sendData</span>(<span class="kw">float</span> value) {
    CURL *curl = <span class="fn">curl_easy_init</span>();
    <span class="kw">if</span> (!curl) <span class="kw">return</span>;

    <span class="cm">// Build JSON</span>
    std::<span class="kw">string</span> body = <span class="str">"{"</span>
        <span class="str">"\"api_key\":\""</span>   + <span class="var">API_KEY</span>   + <span class="str">"\","</span>
        <span class="str">"\"feed_name\":\"" </span>+ <span class="var">FEED_NAME</span> + <span class="str">"\","</span>
        <span class="str">"\"value\":"</span>      + std::<span class="fn">to_string</span>(value) +
        <span class="str">"}"</span>;

    <span class="kw">struct</span> curl_slist *headers = <span class="kw">nullptr</span>;
    headers = <span class="fn">curl_slist_append</span>(headers, <span class="str">"Content-Type: application/json"</span>);

    <span class="fn">curl_easy_setopt</span>(curl, CURLOPT_URL,        <span class="var">API_URL</span>.c_str());
    <span class="fn">curl_easy_setopt</span>(curl, CURLOPT_HTTPHEADER,  headers);
    <span class="fn">curl_easy_setopt</span>(curl, CURLOPT_POSTFIELDS,  body.c_str());

    CURLcode res = <span class="fn">curl_easy_perform</span>(curl);
    <span class="kw">if</span> (res != CURLE_OK)
        std::cerr &lt;&lt; <span class="str">"Error: "</span> &lt;&lt; <span class="fn">curl_easy_strerror</span>(res) &lt;&lt; <span class="str">"\n"</span>;
    <span class="kw">else</span>
        std::cout &lt;&lt; <span class="str">"Sent: "</span> &lt;&lt; value &lt;&lt; <span class="str">"\n"</span>;

    <span class="fn">curl_slist_free_all</span>(headers);
    <span class="fn">curl_easy_cleanup</span>(curl);
}

<span class="kw">int</span> <span class="fn">main</span>() {
    <span class="fn">curl_global_init</span>(CURL_GLOBAL_ALL);

    <span class="kw">while</span> (<span class="kw">true</span>) {
        <span class="fn">sendData</span>(<span class="fn">readSensor</span>());
        std::this_thread::<span class="fn">sleep_for</span>(std::chrono::<span class="fn">seconds</span>(<span class="num">3</span>));
    }

    <span class="fn">curl_global_cleanup</span>();
    <span class="kw">return</span> <span class="num">0</span>;
}

<span class="cm">// Compile: g++ -std=c++17 send_data.cpp -o send_data -lcurl</span></pre>
      </div>

      <!-- cURL -->
      <div class="code-panel border-curl" id="panel-curl">
        <div class="code-header">
          <span>terminal (one-shot POST)</span>
          <button class="btn-copy-code" onclick="copyCode('code-curl', this)">Copy</button>
        </div>
        <pre id="code-curl"><span class="cm"># Quick one-shot test â€” run this in your terminal</span>

<span class="fn">curl</span> -X POST <span class="str">https://dtaiotweb.pythonanywhere.com/api/feed_data</span> \
     -H <span class="str">"Content-Type: application/json"</span> \
     -d <span class="str">'{
           "api_key":   "YOUR_API_KEY",
           "feed_name": "Hi Test",
           "value":     25.50
         }'</span>

<span class="cm"># Expected response:</span>
<span class="cm"># {"status": "ok", "feed": "Hi Test", "value": 25.5}</span>

<span class="cm"># â”€â”€ Loop every 3 seconds (Linux / macOS) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="kw">while</span> true; <span class="kw">do</span>
  VALUE=$(<span class="fn">python3</span> -c <span class="str">"import random; print(round(random.uniform(20,40),2))"</span>)
  <span class="fn">curl</span> -s -X POST <span class="str">https://dtaiotweb.pythonanywhere.com/api/feed_data</span> \
       -H <span class="str">"Content-Type: application/json"</span> \
       -d <span class="str">"{\"api_key\":\"YOUR_API_KEY\",\"feed_name\":\"Hi Test\",\"value\":$VALUE}"</span>
  <span class="fn">echo</span> <span class="str">" Sent: $VALUE"</span>
  <span class="fn">sleep</span> <span class="num">3</span>
<span class="kw">done</span></pre>
      </div>
    </div><!-- /code-section -->
  </div>

  <!-- â•â• Troubleshooting â•â• -->
  <p class="section-title">Troubleshooting</p>
  <div class="card">
    <div class="faq">

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q">
          <span>ğŸ”‘ &nbsp; API Key Not Working?</span>
          <span class="chevron">â–¼</span>
        </div>
        <div class="faq-a">
          Make sure you copied the <em>entire</em> key without any extra spaces. In your code, the key must go in the <code style="font-family:'JetBrains Mono',monospace; color:var(--accent); font-size:.78rem;">api_key</code> field of the JSON body. If the problem persists, try <strong>Regenerating</strong> your key from the profile page.
        </div>
      </div>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q">
          <span>ğŸš« &nbsp; Getting 401 Unauthorized?</span>
          <span class="chevron">â–¼</span>
        </div>
        <div class="faq-a">
          A 401 means the server couldn't validate your key. Double-check that the JSON field name is exactly <code style="font-family:'JetBrains Mono',monospace; color:var(--accent); font-size:.78rem;">"api_key"</code> (lowercase, with underscore). Also confirm you are POSTing to the correct endpoint and that the <code style="font-family:'JetBrains Mono',monospace; color:var(--accent); font-size:.78rem;">Content-Type: application/json</code> header is set.
        </div>
      </div>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q">
          <span>â± &nbsp; Rate Limit Exceeded?</span>
          <span class="chevron">â–¼</span>
        </div>
        <div class="faq-a">
          You've sent too many requests in a short window. The default interval in the example scripts is 3 seconds â€” try increasing the <code style="font-family:'JetBrains Mono',monospace; color:var(--accent); font-size:.78rem;">sleep</code> value. If you need higher throughput, contact support to discuss plan options.
        </div>
      </div>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q">
          <span>ğŸ”§ &nbsp; libcurl Not Found (C / C++)?</span>
          <span class="chevron">â–¼</span>
        </div>
        <div class="faq-a">
          Install libcurl development headers:<br>
          <code style="font-family:'JetBrains Mono',monospace; color:var(--accent); font-size:.78rem;">sudo apt install libcurl4-openssl-dev</code> (Debian/Ubuntu) or
          <code style="font-family:'JetBrains Mono',monospace; color:var(--accent); font-size:.78rem;">brew install curl</code> (macOS). Then compile with <code style="font-family:'JetBrains Mono',monospace; color:var(--accent); font-size:.78rem;">-lcurl</code> as shown in the example comments.
        </div>
      </div>

      <div class="faq-item" onclick="toggleFaq(this)">
        <div class="faq-q">
          <span>ğŸ“¦ &nbsp; requests Module Not Found (Python)?</span>
          <span class="chevron">â–¼</span>
        </div>
        <div class="faq-a">
          Install it with pip: <code style="font-family:'JetBrains Mono',monospace; color:var(--accent); font-size:.78rem;">pip install requests</code>. For embedded Python (e.g., Raspberry Pi), you may need <code style="font-family:'JetBrains Mono',monospace; color:var(--accent); font-size:.78rem;">pip3 install requests</code>.
        </div>
      </div>

    </div>
  </div>

  <!-- â•â• Need More Help â•â• -->
  <p class="section-title">Need More Help?</p>
  <div class="card" style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:1rem;">
    <div>
      <p style="font-weight:700; color:#fff; margin-bottom:.25rem;">Our support team is here for you</p>
      <p style="font-size:.82rem; color:var(--muted);">Reach out any time â€” we usually respond within a few hours.</p>
    </div>
    <div class="support-btns" style="margin-top:0;">
      <a href="mailto:support@dtaiotweb.com" class="btn-support btn-email">âœ‰ Email Support</a>
      <a href="#" class="btn-support btn-docs">ğŸ“– View Documentation</a>
    </div>
  </div>

</div><!-- /page-wrap -->

<script>
/* â”€â”€ Tab switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const langs = ['py', 'c', 'cpp', 'curl'];

function switchTab(lang) {
  langs.forEach(l => {
    document.getElementById('panel-' + l).classList.remove('show');
    const btn = document.getElementById('tab-' + l);
    btn.className = 'tab-btn'; // reset
  });
  document.getElementById('panel-' + lang).classList.add('show');
  document.getElementById('tab-' + lang).classList.add('active-' + lang);
}

/* â”€â”€ Copy API Key â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function copyKey(btn) {
  const val = document.getElementById('apiKeyVal').innerText;
  navigator.clipboard.writeText(val).then(() => {
    btn.textContent = 'âœ“ Copied';
    btn.classList.add('copied');
    setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
  });
}

/* â”€â”€ Copy code block â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function copyCode(id, btn) {
  const raw = document.getElementById(id).innerText;
  navigator.clipboard.writeText(raw).then(() => {
    btn.textContent = 'âœ“ Copied!';
    setTimeout(() => { btn.textContent = 'Copy'; }, 2000);
  });
}

/* â”€â”€ FAQ accordion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toggleFaq(el) {
  el.classList.toggle('open');
}
</script>
</body>
</html>

{% endblock %}